{% extends "base.html" %}

{% block title %}Movements - Inventory Management System{% endblock %}

{% block content %}
<h1>Movements</h1>
<p>View and manage inventory movements</p>

<p>
    <a href="{{ url_for('add_movement') }}" class="btn btn-success">Record New Movement</a>
</p>

<div class="card">
    <h3>Movement History</h3>
    
    {% if movements %}
        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Date & Time</th>
                    <th>Product</th>
                    <th>From</th>
                    <th>To</th>
                    <th>Quantity</th>
                    <th>Notes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for movement in movements %}
                <tr>
                    <td>
                        {% if movement.movement_type == 'Stock In' %}
                            <span class="badge badge-success">{{ movement.movement_type }}</span>
                        {% elif movement.movement_type == 'Stock Out' %}
                            <span class="badge badge-danger">{{ movement.movement_type }}</span>
                        {% else %}
                            <span class="badge badge-info">{{ movement.movement_type }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {{ movement.timestamp.strftime('%Y-%m-%d') }}<br>
                        <small>{{ movement.timestamp.strftime('%H:%M:%S') }}</small>
                    </td>
                    <td>
                        <strong>{{ movement.product.name }}</strong><br>
                        <small>{{ movement.product_id }}</small>
                    </td>
                    <td>
                        {% if movement.from_location %}
                            {{ movement.from_loc.name }}<br>
                            <small>{{ movement.from_location }}</small>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if movement.to_location %}
                            {{ movement.to_loc.name }}<br>
                            <small>{{ movement.to_location }}</small>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td><strong>{{ movement.qty }}</strong></td>
                    <td>
                        {% if movement.notes %}
                            {{ movement.notes[:30] }}{% if movement.notes|length > 30 %}...{% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('edit_movement', movement_id=movement.movement_id) }}" class="btn btn-warning">Edit</a>
                        <form method="POST" action="{{ url_for('delete_movement', movement_id=movement.movement_id) }}" 
                              class="d-inline" onsubmit="return confirmDelete('Are you sure you want to delete this movement?')">
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <h3>No Movements Found</h3>
            <p>Start by recording your first inventory movement.</p>
            <a href="{{ url_for('add_movement') }}" class="btn btn-success">Record First Movement</a>
        </div>
    {% endif %}
</div>
{% endblock %}
